generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// ---------------------
// Enums
// ---------------------

enum EmployeeStatus {
  ACTIVE
  ONBOARDING
  OFFBOARDED
}

enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
}

enum ChecklistType {
  ONBOARDING
  OFFBOARDING
}

enum TaskStatus {
  PENDING
  DONE
}

enum ReviewCycleStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum ReviewType {
  SELF
  MANAGER
  PEER
}

enum ReviewStatus {
  PENDING
  SUBMITTED
}

enum FeedPostType {
  ANNOUNCEMENT
  GENERAL
  BIRTHDAY
  ANNIVERSARY
  NEW_HIRE
  DEPARTURE
}

enum ReactionType {
  LIKE
  CELEBRATE
  HEART
  THUMBSUP
}

enum AttachmentType {
  IMAGE
  FILE
}

enum DocumentCategory {
  ONBOARDING
  OFFBOARDING
  REVIEW
  GENERAL
}

enum CandidateStatus {
  NEW
  SCREENING
  INTERVIEW
  OFFER
  HIRED
  REJECTED
}

enum PositionStatus {
  OPEN
  CLOSED
  FILLED
}

// ---------------------
// Models
// ---------------------

model Department {
  id                 String       @id @default(uuid())
  name               String
  description        String?
  headId             String?
  parentDepartmentId String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  head               Employee?    @relation("DepartmentHead", fields: [headId], references: [id], onDelete: SetNull)
  parentDepartment   Department?  @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id], onDelete: SetNull)
  children           Department[] @relation("DepartmentHierarchy")
  teams              Team[]
  employees          Employee[]   @relation("EmployeeDepartment")
  positions          Position[]

  @@index([headId])
  @@index([parentDepartmentId])
}

model Team {
  id           String     @id @default(uuid())
  name         String
  departmentId String
  createdAt    DateTime   @default(now())

  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  employees    Employee[]

  @@index([departmentId])
}

model Employee {
  id                  String         @id @default(uuid())
  firstName           String
  lastName            String
  email               String         @unique
  phone               String?
  jobTitle            String
  profilePhoto        String?
  departmentId        String?
  teamId              String?
  managerId           String?
  startDate           DateTime
  endDate             DateTime?
  birthday            DateTime?
  anniversaryDate     DateTime?
  hobbies             String?
  bio                 String?
  location            String?
  dietaryRestrictions String?
  benefitsEligibleDate DateTime?
  status              EmployeeStatus @default(ACTIVE)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  department     Department?    @relation("EmployeeDepartment", fields: [departmentId], references: [id], onDelete: SetNull)
  team           Team?          @relation(fields: [teamId], references: [id], onDelete: SetNull)
  manager        Employee?      @relation("EmployeeManager", fields: [managerId], references: [id], onDelete: SetNull)
  directReports  Employee[]     @relation("EmployeeManager")
  user           User?
  headOf         Department[]   @relation("DepartmentHead")

  reviewsAsEmployee  Review[]        @relation("ReviewEmployee")
  reviewsAsReviewer  Review[]        @relation("ReviewReviewer")
  feedPosts          FeedPost[]
  feedComments       FeedComment[]
  feedReactions      FeedReaction[]
  employeeTasks      EmployeeTask[]
  notifications      Notification[]
  documents          Document[]
  assignedChecklistItems ChecklistItem[] @relation("ChecklistItemAssignee")

  @@index([departmentId])
  @@index([teamId])
  @@index([managerId])
  @@index([email])
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String?
  role         UserRole @default(EMPLOYEE)
  employeeId   String?  @unique
  createdAt    DateTime @default(now())

  employee     Employee? @relation(fields: [employeeId], references: [id], onDelete: SetNull)
}

model OnboardingChecklist {
  id        String         @id @default(uuid())
  name      String
  type      ChecklistType
  createdAt DateTime       @default(now())

  items     ChecklistItem[]
}

model ChecklistItem {
  id               String              @id @default(uuid())
  checklistId      String
  title            String
  description      String?
  requiresDocument Boolean             @default(false)
  order            Int
  assigneeId       String?
  dueDay           Int?

  checklist        OnboardingChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  assignee         Employee?           @relation("ChecklistItemAssignee", fields: [assigneeId], references: [id], onDelete: SetNull)
  employeeTasks    EmployeeTask[]

  @@index([checklistId])
  @@index([assigneeId])
}

model EmployeeTask {
  id              String        @id @default(uuid())
  employeeId      String
  checklistItemId String
  status          TaskStatus    @default(PENDING)
  documentUrl     String?
  completedAt     DateTime?
  createdAt       DateTime      @default(now())

  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  checklistItem   ChecklistItem @relation(fields: [checklistItemId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([checklistItemId])
}

model ReviewCycle {
  id        String            @id @default(uuid())
  name      String
  startDate DateTime
  endDate   DateTime
  status    ReviewCycleStatus @default(DRAFT)
  createdAt DateTime          @default(now())

  reviews   Review[]
}

model Review {
  id           String       @id @default(uuid())
  cycleId      String
  employeeId   String
  reviewerId   String
  type         ReviewType
  rating       Int?
  strengths    String?
  improvements String?
  goals        String?
  status       ReviewStatus @default(PENDING)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  cycle        ReviewCycle  @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  employee     Employee     @relation("ReviewEmployee", fields: [employeeId], references: [id], onDelete: Cascade)
  reviewer     Employee     @relation("ReviewReviewer", fields: [reviewerId], references: [id], onDelete: Cascade)

  @@index([cycleId])
  @@index([employeeId])
  @@index([reviewerId])
}

model FeedPost {
  id          String         @id @default(uuid())
  authorId    String
  content     String
  type        FeedPostType   @default(GENERAL)
  pinned      Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  author      Employee       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  comments    FeedComment[]
  reactions   FeedReaction[]
  attachments PostAttachment[]

  @@index([authorId])
}

model FeedComment {
  id        String   @id @default(uuid())
  postId    String
  authorId  String
  content   String
  createdAt DateTime @default(now())

  post      FeedPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  author    Employee @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([authorId])
}

model FeedReaction {
  id         String       @id @default(uuid())
  postId     String
  employeeId String
  type       ReactionType

  post       FeedPost     @relation(fields: [postId], references: [id], onDelete: Cascade)
  employee   Employee     @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([postId, employeeId])
  @@index([postId])
  @@index([employeeId])
}

model PostAttachment {
  id        String         @id @default(uuid())
  postId    String
  url       String
  type      AttachmentType
  name      String
  createdAt DateTime       @default(now())

  post      FeedPost       @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Notification {
  id          String   @id @default(uuid())
  recipientId String
  type        String
  message     String
  link        String?
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())

  recipient   Employee @relation(fields: [recipientId], references: [id], onDelete: Cascade)

  @@index([recipientId])
}

model Document {
  id         String           @id @default(uuid())
  employeeId String
  name       String
  url        String
  category   DocumentCategory
  uploadedAt DateTime         @default(now())

  employee   Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
}

model JobTitle {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
}

// ---------------------
// CV / Recruitment
// ---------------------

model Candidate {
  id            String          @id @default(uuid())
  firstName     String
  lastName      String
  email         String          @unique
  phone         String?
  linkedinUrl   String?
  resumeUrl     String?
  resumeText    String?
  skills        String?
  experience    String?
  status        CandidateStatus @default(NEW)
  source        String?
  notes         String?
  costOfHire    Float?
  appliedAt     DateTime        @default(now())
  hiredAt       DateTime?
  positionId    String?
  recruiterId   String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  position      Position?       @relation(fields: [positionId], references: [id])

  @@index([positionId])
  @@index([status])
  @@index([source])
}

model Position {
  id            String         @id @default(uuid())
  title         String
  departmentId  String?
  description   String?
  requirements  String?
  salary        String?
  status        PositionStatus @default(OPEN)
  candidates    Candidate[]
  createdAt     DateTime       @default(now())

  department    Department?    @relation(fields: [departmentId], references: [id])

  @@index([departmentId])
  @@index([status])
}
